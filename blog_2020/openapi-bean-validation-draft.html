<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>OpenApi generated JAX/RS Service: Bean Validation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/asciidoctor.css" rel="stylesheet">
    <link href="../assets/css/base.css" rel="stylesheet">
    <link href="../assets/css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">GR</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../feed.xml">Subscribe</a></li>
		<!--
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
		-->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

	<div class="page-header">
		<h1>OpenApi generated JAX/RS Service: Bean Validation</h1>
	</div>

	<p><em>13 March 2020</em></p>

	<div class="dlist">
   <dl>
    <dt class="hdlist1">
     	Summary
    </dt>
    <dd>
			<p>Validation of input data is a crucial requirement for every serious application. This also applies to REST services implemented by JAX/RS. If you follow a Design-First development approach with Swagger/OpenApi, server stubs and request/response objects are usually generated. The generated code of API's model classes already contains JSR 380 annotations, which trigger validation of received request objects by the Beans Validation 2.0 framework. This article is about application-specific extension of validation rules for generated model classes.</p>
    </dd>
   </dl>
  </div>

	<p><div id="preamble"> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>&nbsp;</p> 
  </div> 
  <div class="paragraph"> 
   <p>Implementing JAX/RS REST APIs with Swagger/OpenApi following a Design-First approach starts with the formal specification of the REST API. Then Swagger/OpenApi generators are used to create server stubs as well as client API code. For Java JAX/RS generated servers, the request model classes already contain validations in form of JSR 380 annotations like <code>@NotNull</code>. But because of limitations in validation specification with OpenApi or gaps of the code generators, more often than not, validation rules need to be added to the generated model classes. There are differe This article (series) is about to add such validation rules.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Some words about JSR 380 …​ Jakarta Bean Validation 2.0 standard for checking validity of</p> 
  </div> 
  <div class="paragraph"> 
   <p>Example</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Range   {

  private @Valid Integer min;
  private @Valid Integer max;


  @ApiModelProperty(required = true)
  @JsonbProperty("min")
  @NotNull
  @Min(1)
  public Integer getMin() {
    return min;
  }
  public void setMin(Integer min) {
    this.min = min;
  }

  @ApiModelProperty(required = true)
  @JsonbProperty("max")
  @NotNull
  @Min(1)
  @Max(1000)
  public Integer getMax() {
    return max;
  }
  public void setMax(Integer max) {
    this.max = max;
  }


  @Override
  public boolean equals(java.lang.Object o) {
    if (this == o) {
      return true;
    }
    if (o == null || getClass() != o.getClass()) {
      return false;
    }
    Range range = (Range) o;
    return Objects.equals(this.min, range.min) &amp;&amp;
        Objects.equals(this.may, range.max);
  }

  @Override
  public int hashCode() {
    return Objects.hash(min, max);
  }

  @Override
  public String toString() {
    StringBuilder sb = new StringBuilder();
    sb.append("class Range {\n");
    sb.append("    min: ").append(toIndentedString(min)).append("\n");
    sb.append("    max: ").append(toIndentedString(max)).append("\n");
    sb.append("}");
    return sb.toString();
  }

  private String toIndentedString(java.lang.Object o) {
    if (o == null) {
      return "null";
    }
    return o.toString().replace("\n", "\n    ");
  }
}</code></pre> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>Range request object - OpenApi definition of the request object - POST endpoint</p> 
  </div> 
  <div class="paragraph"> 
   <p>Generated Code</p> 
  </div> 
  <div class="paragraph"> 
   <p><a href="#sample">[sample]</a></p> 
  </div> 
  <div class="paragraph"> 
   <p>Changing generated code is not an option. Because of the individual nature of the validation rules, the custom template are also no viable solution/way.</p> 
  </div> 
  <div class="paragraph"> 
   <p>requirements: - Violations should be reported the same way as the violations of the generated JSR 380 annotations. - Violations should be</p> 
  </div> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_naive_approach_validation_intermingled_with_business_logic">Naive Approach: Validation intermingled with business logic.</h2> 
 <div class="sectionbody"> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_cdi_validation">CDI Validation</h2> 
 <div class="sectionbody"> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>unther@gunther-K501UQ:~/_work/java/beans-validation$ curl -v -H "Content-type: application/json" -H "Accept: application/json" http://localhost:8080/beans-validation/cdi/validate -d '{"min": 1, "max": 100 }'
*   Trying 127.0.0.1:8080...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; POST /beans-validation/cdi/validate HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/7.65.3
&gt; Content-type: application/json
&gt; Accept: application/json
&gt; Content-Length: 23
&gt;
* upload completely sent off: 23 out of 23 bytes
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 400 Bad Request
&lt; Connection: keep-alive
&lt; validation-exception: true
&lt; Content-Type: application/json
&lt; Content-Length: 369
&lt; Date: Wed, 11 Mar 2020 19:10:10 GMT
&lt;
* Connection #0 to host localhost left intact
{"exception":null,"fieldViolations":[],"propertyViolations":[],"classViolations":[],"parameterViolations":[{"constraintType":"PARAMETER","path":"validate.arg0.max","message":"must be greater than or equal to 1","value":"0"},{"constraintType":"PARAMETER","path":"validate.arg0.min","message":"must be greater than or equal to 1","value":"0"}],"returnValueViolations":[]}</code></pre> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_xml_deployment_descriptor">XML Deployment Descriptor</h2> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>Output of unit test</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlightjs highlight"><code>gunther@gunther-K501UQ:~/_work/java/beans-validation$ curl -v -H "Content-type: application/json" -H "Accept: application/json" http://localhost:8080/beans-validation/xml/validate -d '{"min": 1, "max": 100 }'
*   Trying 127.0.0.1:8080...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; POST /beans-validation/xml/validate HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/7.65.3
&gt; Content-type: application/json
&gt; Accept: application/json
&gt; Content-Length: 23
&gt;
* upload completely sent off: 23 out of 23 bytes
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 400 Bad Request
&lt; Connection: keep-alive
&lt; validation-exception: true
&lt; Content-Type: application/json
&lt; Content-Length: 369
&lt; Date: Wed, 11 Mar 2020 19:09:22 GMT
&lt;
* Connection #0 to host localhost left intact
{"exception":null,"fieldViolations":[],"propertyViolations":[],"classViolations":[],"parameterViolations":[{"constraintType":"PARAMETER","path":"validate.arg0.min","message":"must be greater than or equal to 1","value":"0"},{"constraintType":"PARAMETER","path":"validate.arg0.max","message":"must be greater than or equal to 1","value":"0"}],"returnValueViolations":[]}</code></pre> 
   </div> 
  </div> 
 </div> 
</div></p>

  <span>Tags:
	</span>

	<hr />

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2020 Gunther Rotsch | <a href= "/contact.html">Contact and Legal Notice</a>
        <!--| Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.1</a></p>
          -->
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/jquery-1.11.1.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/prettify.js"></script>

  </body>
</html>
